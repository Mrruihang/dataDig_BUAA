## 任务3：时间序列预测

### 3.0 问题的形式化描述
- 数据集 `weather.csv` 记录了德国某气象站 6 个月内每 10 分钟一次的 21 个气象特征（26200 个时间点）。
- 目标：根据最近 2 小时（12 个时间点）的全部气象指标，预测下一时间点的室外温度 `OT`。
- 记第 `t` 个时间点的 21 维向量为 `x_t`，目标是学习函数  
  `f([x_{t-11}, …, x_t]) -> OT_{t+1}`，以最小化下一时刻温度的回归误差。

### 3.1 数据预处理 + 训练/测试划分
- 读取 CSV 时使用 `ISO-8859-1` 编码并将 `date` 转为时间戳，按时间排序。
- 对每个时间点保留 21 个数值特征（含目标 `OT`），采用滑动窗口方式构造样本：
  - 窗口长度 12（2 小时），即将 `[x_{t-11}, …, x_t]` 展开成 `12 × 21 = 252` 维特征；
  - 目标值取 `OT_{t+1}`，共得到 `26200-12=26188` 个样本。
- 为防止信息泄露，先按时间顺序划分，再对训练部分拟合 `StandardScaler`，将所有 252 维特征标准化：
  - 训练集：前 80%（20,950 条样本）；
  - 测试集：后 20%（5,238 条样本）。

### 3.2 模型与设计思想
- **模型**：`GradientBoostingRegressor`（400 棵浅树，学习率 0.05，子采样 0.9，`max_depth=3`）。
- **思路**：
  - 通过滑动窗口把序列问题转化为回归问题，使得树模型可以直接处理；
  - GBDT 对非线性关系、不同量纲以及少量异常点较鲁棒，比线性自回归具有更强表达力；
  - 与 LSTM 等深度模型相比，训练更快且无需额外框架，适合在纯 CPU 环境下快速迭代；
  - 使用标准化后的 252 维向量可让树模型更容易比较不同特征的增益。
- 训练脚本：`python weather/task3_timeseries.py`，实现加载、预处理、建模与评估的完整流程。

### 3.3 评估结果
在测试集上输出以下指标（`weather/task3_timeseries.py`）：

| 指标 | 数值 |
| --- | --- |
| MAE | 9.593 ℃ |
| RMSE | 38.306 ℃ |
| MAPE | 2.15 % |
| R² | -1.873 |

- MAPE 较低，说明相对误差仅 ~2%（`OT` 数值约 400 左右）；然而绝对指标和 R² 显示预测在绝对温度刻度上仍有偏差，需进一步改进。
- 潜在优化：更换为序列模型（LSTM/Temporal Convolution）、单独建模温度相关特征、或对 `OT` 做差分/去趋势处理，可望提升 R²。

### 3.4 可视化结果说明（输出图片）
运行 `python weather/task3_timeseries.py` 时，会在 `weather/figures` 目录下生成 3 张英文标注的图片，帮助理解模型在测试集上的表现：

- **`task3_y_true_vs_pred.png`**：测试集真实 OT 与预测 OT 的散点图  
  - X 轴为 **True OT (°C)**，Y 轴为 **Predicted OT (°C)**，红色虚线表示理想情况 `y = x`。  
  - 点越集中在对角线附近，说明预测越准确；系统性偏离则反映出整体偏差或非线性未充分拟合。

- **`task3_timeseries_true_vs_pred.png`**：测试集前 500 个时间点的温度曲线对比  
  - 横轴为 **Time**，纵轴为 **OT (°C)**，蓝色曲线为真实温度（True OT），橙色曲线为预测温度（Predicted OT）。  
  - 该图可以观察模型是否能够捕捉短期波动、周期性变化，以及是否存在滞后或幅度缩小等问题。

- **`task3_residuals_over_time.png`**：残差随时间变化图  
  - 残差定义为 `y_true - y_pred`，图中纵轴为 **Residual (°C)**，横轴为 **Time**，黑色水平线为 0。  
  - 若残差在 0 附近随机上下波动，说明误差近似无偏；若长期偏正或偏负，或随时间呈现结构性趋势，则提示模型可能存在系统性偏差或未建模的时变因子。

